<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Soudrop - Transforme suas vendas online com automação de marketplaces.</title>
    <meta name="description" content="Automatize a gestão de múltiplos marketplaces com Soudrop. Integração perfeita, logística sem preocupações e controle total das suas vendas em um único painel." />
    <meta name="author" content="Soudrop" />

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <meta property="og:title" content="Soudrop - Automação de Vendas em Múltiplos Marketplaces" />
    <meta property="og:description" content="A integração perfeita, logística sem preocupações e controle total das suas vendas em um único painel. Vender nunca foi tão fácil." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://app2.soudrop.com.br/images/logo_login_soudrop.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://app2.soudrop.com.br/images/logo_login_soudrop.png" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CN06VFEFFH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-CN06VFEFFH');
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- UTM Tracking Script -->
    <script>
    (function() {
      var qs = window.location.search;
      if (!qs || qs === '?') return; // sem UTM, não faz nada
      var links = document.querySelectorAll('a[href*="kiwify.com"], a[href*="checkout.kiwify.com"]');
      links.forEach(function(link) {
        var sep = link.href.indexOf('?') > -1 ? '&' : '?';
        if (link.href.indexOf('utm_') === -1) {
          link.href = link.href + sep + qs.replace(/^\?/, '');
        }
      });
    })();
    </script>

    <!-- URL Masking & UTM Preservation Script -->
    <script>
    (function() {
      // ===== Ajuste a sua base fixa aqui =====
      var BASE_PATH = "/fontes-secretas";

      // ----- UTMs: capturar e preservar ao longo da sessão -----
      function saveInitialUTM() {
        var qs = window.location.search || "";
        if (qs && qs.indexOf("utm_") > -1) {
          sessionStorage.setItem("utm_qs", qs.replace(/^\?/, ""));
        }
      }
      function getPreservedQS() {
        var current = window.location.search;
        if (current && current !== "?") return current; // já tem query atual
        var saved = sessionStorage.getItem("utm_qs");
        return saved ? ("?" + saved) : ""; // volta as UTMs originais, se necessário
      }

      // ----- Normalização da URL para manter sempre /fontes-secretas -----
      function normalizeURL() {
        try {
          var loc = window.location;
          var path = loc.pathname;
          var search = getPreservedQS();
          var hash = loc.hash || "";

          // Se já está exatamente em /fontes-secretas, só garanta que as UTMs preservadas apareçam
          if (path === BASE_PATH) {
            // Se não há utm na search atual mas temos uma preservada, atualiza sem recarregar
            if ((!loc.search || loc.search === "?") && search) {
              history.replaceState(history.state, document.title, BASE_PATH + search + hash);
            }
            return;
          }

          // Se é uma rota do mesmo fluxo (ex.: /fontes-secretas-qualquercoisa), mascarar para /fontes-secretas
          if (path.indexOf(BASE_PATH) === 0) {
            history.replaceState(history.state, document.title, BASE_PATH + search + hash);
            return;
          }
        } catch (e) { /* silencioso */ }
      }

      // ----- Patches para rotas SPA (pushState/replaceState/popstate) -----
      ["pushState","replaceState"].forEach(function(fn){
        var orig = history[fn];
        history[fn] = function() {
          var r = orig.apply(this, arguments);
          // dá tempo do router trocar a rota antes de normalizar
          setTimeout(normalizeURL, 0);
          return r;
        };
      });
      window.addEventListener("popstate", normalizeURL);

      // ----- Execução inicial -----
      saveInitialUTM();
      // Normaliza quando o DOM estiver pronto e também logo de cara
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", normalizeURL);
      } else {
        normalizeURL();
      }
      // Re-normaliza após pequenos atrasos de renderização do app
      setTimeout(normalizeURL, 50);
      setTimeout(normalizeURL, 250);
    })();
    </script>
  </body>
</html>
